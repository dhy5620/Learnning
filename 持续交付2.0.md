# 第四章、组织文化

安全、信任与持续改善：
　　失败是安全的：组织对待“失败”的态度至关重要
　　相互信任：同事之间的相互信任
　　持续改善：不断的试验而持续改进（特点是“人人参与”和“时时改善”）
文化塑造四步法（谷歌）：
　　第一步：定义想要做的事情
　　　　提高代码质量、减少生产问题、减少手工测试工作量，快速发布软件
　　第二步：定义期望的做事方法
　　　　开发团队编写自动化测试
　　　　主动运行自动化测试用例
　　　　做代码评审
　　第三步：提供相应的培训
　　　　在公司范围内组织代码设计与自动化测试培训
　　　　为每个团队指派自动化测试教练，帮助团队提高自动化测试技能
　　第四步：做些必须的事情强化这些行为
　　　　建立团队测试认证机制，共分3个大级别，12个子级，用于评估每个软件产品团队的测试成熟度。通过每个季度统计各级别上的团队数量分布，来评估自动化测试文化在公司内部的进展程度
　　　　建立自动化测试组和测试教练组，帮助团队提升自动化测试能力
　　　　建立代码评审资质证书
　　　　代码合入版本仓库前强制做代码评审
　　　　代码评审之前，必须运行自动化测试用例，并提交报告给代码评审者
行动原则：
　　价值导向：我们做事情时，应该价值导向
　　快速验证：通过快速实施，得到真实反馈，从而做出决策
　　持续学习：
　　　　定期回顾：每隔一定周期，团队主动安排一次会议，共同讨论在过去的这个周期内，团队在协作过程中的优点和不足，并讨论相应的决策，以便在后续的工作中能够保持优点，改进不足，持续取得进步。回顾会议结束后，应该有改进措施和计划，并能够跟踪执行结果。另外，不要指定过多的改进项，以免落入“反复提出，反复执行，没有实际进展”的境况
　　　　复盘机制：指针对发生的问题进行分析，其目的是避免相同问题重复出现。
　　　　　　首先针对问题发生的前后进行信息收集和整理，确定问题的严重程度，理解问题发生的过程（对于疑难问题，可能还需要在事故后进行线下模拟测试，甚至线上测试，以复现问题和寻找原因）
　　　　　　然后进行根因分析
　　　　　　　　对于根因分析，需要注意以下几点
　　　　　　　　1.放松心态，开放共享
　　　　　　　　2.分清“因”和“果”
　　　　　　　　3.五问法，鼓励多问“为什么”
　　　　　　　　4.发挥群体智慧
　　　　　　　　5.不要停于表面，而要寻找深层次原因
　　　　　　　　6.对答案进行求证
　　　　　　最后总结经验，制定改进措施与计划，并能够跟踪执行结果
　　　　　　值得一提的是，对于每一次复盘，都应该详细记录和总结，作为知识在企业中全员共享。只有这样，才能收益最大化
　　　　　　系统思考方法：系统思考是从整体上对影响系统行为的各种力量和相互关系进行思考，以培养人们对复杂性、相互依存关系、变化及影响力的理解与决策力。在系统思考中，因与果并不是绝对的，因与果之间有可能是环形互动的，即“因”产生“果”，此“果”又成为他“果”之“因”，甚至成为“因”之“因”
度量原则：
　　度量指标的4类属性：
　　　　1.引领性指标：指那些对达成预定目标有着重要作用的指标。通常，一个好的引领性指标有以下两个基本特点：具有预见性，团队成员可以影响这些指标，如软件质量和性能
　　　　2.滞后性指标：指那些为了达成最重要目标的跟踪性指标，如销售收入、利润率、市场份额、客户满意度等研究分析都属于滞后性指标
　　　　3.可观测性指标：指可以被客观观测到，但无法通过直接行动来改变的指标，如千行代码缺陷率
　　　　4.可行动性指标：指在能力可触达范围内，通过团队努力，可以设法直接改变的指标，如代码规范符合度，代码圈复杂度，重复代码率
　　　　衡量IT 高绩效组织的4个度量项：发布频率、发布周期、MTBF（平均失效间隔：新的产品在规定的工作环境条件下从开始工作到出现第一个故障值的时间的平均值）/MTTR（平均恢复时间：指从故障出现到恢复之间的时间周期）、吞吐量（在给定时间段内系统完成的交付物数量），以上四个指标可以看做滞后性指标。编译速度、测试时长、部署效率可作为引领性指标
　　度量的目标是改善：通过设法管理过程指标来改善我们的工作过程，并将最终的效果与我们期望的结果指标作对比，从而发现改进是否有效，并判断是否需要改变改进方向，还是继续向前。过程指标离终极结果指标越远，对终极结果的影响作用就越不明确，其贡献越不直接。
“改善套路”进行持续改进：
　　第一阶段：明确方向：始终以愿景为工作目标，并持续不断地改进
　　第二阶段：掌握当前状态：掌握当前状态，获得事实与数据，才能充分认识自己
　　第三阶段：定义下一个目标状态：目标状态就是确定团队希望达到的状态，设置期望达到该状态的日期，并定义可衡量的指标项
　　第四阶段：迭代改进：遵循戴明环，不断迭代试验，发现、实施、评估并改善方案，直到达成目标状态（戴明环，又叫P（Plan）D（Do）C（Check）A（Action），反映了质量管理活动的规律）

# 第五章、软件系统架构

“大系统小做”原则：
　　持续交付架构要求：系统架构在设计时应该考虑如下因素
　　　　1.为测试而设计
　　　　2.为部署而设计
　　　　3.为监控而设计
　　　　4.为扩展而设计：支持团队成员规模的扩展，支持系统自身的扩展
　　　　5.为失效而设计：一旦部署或发布失败，如何优雅且快速的处理
　　系统拆分原则：
　　　　1.作为系统的一部分，每个组件或服务有清晰的业务职责，可以被独立修改，甚至被另一种实现方案所替代
　　　　2.“高内聚，低耦合”，使整个系统易于维护，每个组件或服务只知道尽可能少的信息，完成相对独立的单一功能
　　　　3.整个系统易于构建与测试。将系统拆分后，这些组件仍需要组合在一起，为用户提供服务
　　　　4.使团队成员之间的沟通协作更加顺畅
常见架构模式：
　　微核架构：又叫插件架构，指的是软件的核心框架相对较小，而其主要业务功能和业务逻辑都通过插件实现。核心框架部分通常只包含系统启动运行的基础功能，例如基础通信模块、基本渲染功能和界面整体框架等。插件则是相互独立的，插件之间的通信只通过核心框架进行，避免出现相互依赖的问题。
　　　　优点：
　　　　良好的功能延伸性：需要什么功能，开发一个插件即可
　　　　易发布：插件可以独立的加载和卸载，使它比较容易发布
　　　　易测试：功能之间是隔离的，可以对插件进行隔离测试
　　　　可定制性高：适应不同的开发需要
　　　　可以渐进式的开发：逐步增加功能
　　　　缺点：
　　　　扩展性差：内核通常是一个独立单元，不容易做成分布式，但对客户端软件来说，这就不是一个严重问题
　　　　开发难度相对较高，因为涉及插件和内核的通信，以及内部的插件登记机制等，比较复杂
　　　　高度依赖框架，既享受框架带来的方便性，当框架接口升级时又可能会影响所有插件，导致大量的改造工作
　　微服务架构：将单一应用程序划分成一组小的服务，服务之间相互协调，相互配合，为用户提供最终价值。
　　　　优点：
　　　　扩展性好：各个服务之间低耦合。可以对其中的个别服务单独扩容
　　　　易部署：每个服务都是可部署单元
　　　　易开发：每个组件都可以进行单独开发，单独部署，不间断的升级
　　　　易于单独测试：如果修改只涉及单一服务，那么只测试该服务即可
　　　　缺点：
　　　　由于强调互相独立和低耦合，服务可能会被拆分的很细。这导致系统依赖大量的微服务，变得很凌乱和笨重，网络通信消耗也会比较大
　　　　一次外部请求会涉及内部多个服务之间的通信，使得问题的调试与诊断比较困难，需要更强大的工具支持
　　　　为原子操作带来困难，例如需要事务类操作的场景
　　　　跨服务的组合业务场景的测试比较困难，通常需要同时部署和启动多个微服务
　　　　公共类库的升级管理比较难。在使用有一些公共的工具性质的类库时，需要在构建每个微服务时将其打包到部署包中
　　巨石应用：也称巨石架构，是指由单一结构体组成的软件应用，其用户接口和数据访问代码都绑定在同一语言平台的同一应用程序
　　　　优点：
　　　　利于开发和调试：当前所有开发工具和IDE都很好的支持了巨石应用程序的开发，系统架构简单，调试方便
　　　　部署操作本身比较简单：只需一个War文件即可包含所有功能
　　　　很容易扩展：只要在负载均衡器后面运行这个应用的多个副本就可以扩展应用程序。
　　　　缺点：
　　　　对整体程序不熟悉的人来说，容易产生混乱的代码，污染整个应用，给老代码的学习和理解带来困难
　　　　难与新技术共同应用
　　　　只能将整个应用作为一个整体进行扩展
　　　　持续部署比较困难。为了更新一个组件，必须重新部署整个应用程序
架构改造实施模式
　　拆迁者模式：根据当前的业务需求，对软件架构重新设计，并组织单独的团队，重新开发一个全新的版本，一次性完全替代原有的遗留系统
　　　　优点：与旧版本无瓜葛，没有历史包袱，可以按预期进行架构设计
　　　　缺点：
　　　　业务需求遗漏：软件的历史版本中，有很多不为人熟知的功能还在使用
　　　　市场环境变化：由于新版本架构无法 一蹴而就，当市场需求发生变化时，就会错失市场良机
　　　　人力资源消耗大：必须分出人力，一边维护旧版本的功能或紧急需求，一边要安排充分人力进行架构改造
　　　　闭门造车：新版本上线后，无法满足业务需求
　　绞杀者模式：保持原来的遗留系统不变，当需要开发新的功能时，重新开发一个服务，实现新的功能。通过不断的构建新的服务，逐步使遗留系统失效，并最终替代它
　　　　优点：
　　　　不会遗漏原有需求
　　　　可以稳定的提供价值，频繁的交付版本，可以让你更好的监控其改造进程
　　　　避免“闭门造车”现象
　　　　缺点：
　　　　架构改造的时间跨度会变大
　　　　产生一定的迭代成本
　　修缮者模式：将遗留系统的部分功能与其余部分隔离，以新的架构进行单独改善。在改善的同时，需要保证与其他部分仍能协同工作
　　　　优点：
　　　　系统外部无感知
　　　　不会遗漏原有需求
　　　　可以随时停下改造工作，响应高优先级的业务需求
　　　　避免“闭门造车”现象
　　　　缺点：
　　　　架构改造的时间跨度会变大
　　　　会有更多的额外的架构改造迭代成本
　　数据库的拆分方法：
　　　　详细了解数据库结构，包括外键约束、共享的可变数据以及事务性边界等
　　　　先拆分数据库
　　　　数据库双写无误后，找到程序架构中的缝隙
　　　　将拆分出来的程序模块和数据库组合在一起，形成微服务

# 第六章、业务需求协作管理

业务需求协作管理贯穿于整个软件产品版本周期，涉及与业务软件交付相关的所有角色，包括业务人员、产品及运营人员、开发人员、测试人员和运维人员等
目标是通过改善各角色在持续交付“8”字环各环节中的交互协作流程，有效且高效的完成业务问题的分析、业务方案的实施和结果验证工作，并确保所有需求不遗漏，被完整跟踪
产品的整个生命周期（5个阶段）
　　概念阶段：需要清楚回答市场机会、客户需求的紧迫性、企业自身的竞争优势、产品的可行性以及自身产品团队能力等问题
　　孵化阶段：考察产品核心功能的完善度、满足典型目标用户的核心诉求程度，小范围试验用户的反馈等问题
　　验证阶段：主要关注最小核心功能集的用户体验、早期用户的反馈、盈利模式，以及产品技术核心团队的稳定性与加大资源投入的可行性
　　运营阶段：主要关注市场环境变化、客户泛化需求的存在性，以及投入产出比
　　业务退市阶段：运营阶段的要素不满足企业的预期，可考虑产品的退市步骤
　　除概念阶段以外，每个阶段都至少包含一个产品版本周期。
　　在每个产品版本周期中，又分为准备期和交付期。它们由多个迭代构成，每个迭代至少包含一个持续交付“8”字环，用于解决一个（或一组）业务领域问题
产品版本周期概述：
　　准备期（迭代0或启动期）：团队成员共同探索发现与决策的过程，是一个先发散后聚焦的过程。
　　　　参与者通常包括有决策权的业务方各角色代表与IT方各角色代表
　　　　核心任务是达成业务理解与目标的共识
　　　　目标是让参与该产品版本周期的所有角色对期望解决的业务问题以及最小可行解决方案达成共识。
　　　　主要包括以下工作内容：
　　　　　　1.目标阐述与理解：业务代表讲解当前这个产品版本周期内所需达成的重要业务目标，以及相关的业务上下文。参与者应积极参与互动，以便充分理解业务
　　　　　　2.业务领域角色与流程识别，及解决方案的探索：全体参与者共同讨论并识别该业务问题所涉及的主要业务流程与流程中的业务角色，并找到尽可能多的解决方案
　　　　　　3.重大风险识别与验证：识别各种方案中的业务与技术风险，并且组织人员对那些影响决策的重大风险进行快速验证
　　　　　　4.精炼并达成最小可行方案共识：从众多的解决方案中挑选并制定最小可行解决方案
　　　　　　5.评估与计划：对最小可行解决方案进行初步的工作量与时间评估，制订相应的交付计划
　　交付期：由多个迭代组成，各迭代周期应尽量保持一致
　　　　目标是通过快速迭代，最终验证或解决该业务问题
　　　　团队应该在当前迭代刚刚开始后，立即着手对后续迭代要开发的需求进行详细分析，并在下一个迭代开始前，确保所有参与者对需求的验收条件理解一致，达成共识
　　　　　　以上做法会有两个收益，一是更早发现还存在风险的需求，提前进行沟通和准备，二是一旦提前完成了当前迭代的内容，可以从下个迭代需求列表中选择一些需求进行开发，没有间断
　　　　　　每个角色会有多种任务
　　　　　　　　产品人员：
　　　　　　　　　　及时回答其他角色对本次迭代需求提出的疑问
　　　　　　　　　　及时验收在本迭代中完成的需求
　　　　　　　　　　组织其他角色，为准备后续迭代的内容进行需求筛选与分析
　　　　　　　　开发人员：
　　　　　　　　　　开发当前迭代中的需求
　　　　　　　　　　及时修复测试人员发现的缺陷
　　　　　　　　　　参与后续迭代的需求分析与用例评审
　　　　　　　　测试人员：
　　　　　　　　　　及时验收刚刚开发完成的需求
　　　　　　　　　　验收已被修复的缺陷
　　　　　　　　　　参与后续迭代的需求分析，并对其进行测试用例分析，组织测试用例评审
　　　　　　　　同时开发人员与测试人员还要应对生产环境出现的问题，及时进行分析与解决
需求拆分的利与弊
　　利于持续交付的需求拆分总原则：坚持以业务视角对需求进行分解
　　需求拆分的收益：
　　　　建立共识，协调工作：需求拆分时，与该需求相关的所有角色均需参与。每个需求的边界上下文都应被充分讨论，从而让各角色对该需求的目标、质量标准和验收条件达成一致
　　　　小批量交付，加速价值流动：将较大的需求进行拆分后，就能够进行小批量开发与测试，从而尽早的交付软件，让用户更早的使用软件
　　　　低成本拥抱变化：在分批交付过程中，一旦在开发过程中遇到突发情况，团队可以快速将手中任务完成（或放弃），然后投入新插入的高优先级需求
　　　　多次集成，及时反馈质量：小批量需求开发完成后无法马上交付给用户，我们也可以进行联调与测试。如果发现软件缺陷，则可以及时修复
　　　　　　缺陷过多，可能是3种原因：
　　　　　　　　开发人员对需求理解尚不到位
　　　　　　　　研发质量标准没有得到很好的贯彻执行
　　　　　　　　团队成员之间沟通不充分，有很多误报现象
　　　　鼓舞团队士气：每个迭代开发的新功能都立即被用户使用，并且得到反馈，团队就会收到鼓舞
　　需求拆分的成本：
　　　　需求拆分时的显式成本：将其他角色卷入需求拆分的过程，会在项目前期增加更多的沟通成本
　　　　分批开发、测试和部署的迭代成本：分批迭代交付，为了达到交付质量，需要进行验证，以确保功能正确运行。验证次数增多，则对应的验证投入成本会增加

需求拆分方法：
　　需求的来源：
　　　　进入交付期前，最小可行解决方案的需求列表中，需求来源由以下3部分组成
　　　　　　业务人员提出的业务功能需求。这些业务需求构成了整个产品版本的基础需求
　　　　　　为了保障业务需求的实现与运行而必须满足的非业务功能需求，例如因页面响应时间要求而产生的性能需求、因成本控制而产生的自动扩缩容要求等
　　　　　　符合安全合规性而产生的安全开发需求
　　　　进入交付期后，每个迭代的需求列表中，需求来源可以包括以下7个部分
　　　　　　从原始需求列表中选出的待实现需求
　　　　　　在需求细化过程中新发现的需求
　　　　　　已知且需要修复的线上生产系统缺陷
　　　　　　线上技术运营要求
　　　　　　前期预研需求，它是指团队目前尚不具备能力，但为了实现某一业务需求而做的准备工作
　　　　　　技术债需求，它是指因早期业务进度压力而积累的技术债改进需求
　　　　　　辅助测试需求：为了便于进行需求验收，需要开发的测试辅助工具
　　技术债也是需求：
　　　　技术债：指技术团队在设计架构或者开发的过程中，基于短期目标选择了一个方便实现的方案，而从长远考虑，这种方案会带来长久的消极影响
　　　　技术债产生的原因：
　　　　　　满足眼前需求，没有更进一步考虑。即使后续增加功能也没有进行适当重构
　　　　　　低质量代码（硬编码、魔术数字、重复代码等）
　　　　对持续交付模式来说，还有一种“技术债”，即影响软件交付速度或业务响应速度的所有重复性且需要花费较长时间的手工操作，例如手工准备测试环境、手工回归测试、手工部署与发布等
　　参与需求拆分的角色：
　　　　传统瀑布开发模式：产品经理（或业务分析师）撰写需求规格说明书
　　　　持续交付模式：产品经理、开发人员、测试人员等都参与用户故事的编写
　　不平等的INVEST原则：
　　　　Independent（独立）：用户故事必须彼此独立，低耦合
　　　　negotiable（可协商）：在进入开发前，故事卡用来提醒团队和干系人要进行讨论，而不是直接作为产品人员与开发人员之间的契约来使用
　　　　valuable（有价值）：用户故事对用户或客户来讲必须是重要的，有价值的
　　　　estimable（可估算）：开发团队必须能够估算创建用户故事所需的工作量
　　　　Small & similar size（规模小且适中）：用户故事必须足够小，尽可能要在一个迭代内完成（建议用户故事的开发工作量应该少于3个工作日）；并且多个用户故事之间的开发工作量差异不宜过大
　　　　testable（可验证）：用户故事必须是可以被验证的
　　　　一些比较复杂的用户需求，很难同时满足这6个原则，但至少要满足可估算、规模小且可验证，及EST>INV
　　　　假如无法独立交付，但在较短时间内可以独立开发和独立验证，且不影响当前完成的软件功能，则也是可行的
　　　　SMART原则：具体的（specific）、可衡量的（measurable）、可达成的（achievable）、相关的（relevant）、有时间限定的（time bound）
五大拆分技法
　　路径拆分法：根据用户使用场景中的不同路径进行拆分，例如用户在电商网站购物以后，需要支付订单，可以选择微信支付，也可以选择银行卡支付，这就可以拆分为两个故事卡
　　按接触点拆分：所谓接触点就是指用户与系统之间的交互通道，例如移动端应用和PC浏览器是两种不同的接触点
　　按数据类型或格式拆分：例如有一个软件，用来做数据统计和分析。其中有这样一个需求，用户可以通过文件形式向软件系统导入数据，文件格式包括csv、xml、excel
　　按规则拆分：规则是指业务规则或技术规则
　　按探索路径拆分：在开发过程中，团队总是遇到一些对团队来说都很陌生的事物或不确定的实现方案。此时可以将对陌生事物的试验性探索逐步分拆成不同的探索故事
七大组成部分：
　　用户故事（最早来自极限编程的十二最佳实践，称呼交付迭代中的需求，用户故事刚刚诞生的初始形式）：
　　　　作为 ……一个xxxxx用户……
　　　　为了完成 ……yyyyyyy业务……
　　　　我希望能够 ……使用zzzzz功能……
　　7个组成部分：
　　　　1.编号：方便记录与跟踪
　　　　2.名称：该功能及其目标概要
　　　　3.描述：简单介绍这个功能的上下文和业务目的与要求
　　　　4.技术备忘：简单记录每次讨论过程中的一些重要技术点，可能会包括一些设计信息
　　　　5.前提假设：在对该用户故事进行估算或启动实现时，应该满足哪些前提假设
　　　　6.依赖关系：该用户故事依赖哪些内外需求
　　　　7.验收条件：该用户故事达到交付标准的定义与描述
需求分析与管理工具集：
　　用户故事地图：
　　　　用户故事地图的概念来自《用户故事地图》，既是一种团队沟通工具，也是一种需求分析管理工具
　　　　常被用于产品版本周期中的准备期
　　　　它用结构化的二维视图统一团队成员思维模式，从用户主流程和业务紧急程度两个维度共同分析，并可以定期将该地图取出，重新审视与修订
　　用户故事树：为了看产品特性的全貌，可以使用树状方式进行用户故事的管理
　　依赖关系图：从依赖角度来建立用户故事之间的关联关系
　　需求管理数字化平台：类似看板
团队协作管理工具：
　　团队共享日历：
　　　　团队时间表：对多角色参与的常规活动提前进行时间安排，它可以让所有角色都根据这一固定时间表来规划个人的工作时间与节奏，减少不必要的协调成本，团队时间表中规定了在一个迭代周期中的各种例行协作时间点和内容
　　　　个人非工作时间表：指一个团队的工作日历。团队中的每个人都将其可预期的非工作时间提前标记下来，如自己已计划的年假，或者可预期的事假
　　团队回顾：
　　　　所有团队成员在一起共同对过去一段时间中的团队协作状态进行总结，以便继续保持那些良好的协作习惯，同时持续发现协作中存在的可提升空间，共同探索改进方案
　　　　参与者：过去一段时间中参与产品准备或交付活动的所有成员
　　　　回顾会议的产出是一个团队达成共识的可执行的改善行动列表，并且每一个行动项都要指定一个跟踪者，负责跟踪该行动的执行情况，并在下次回顾会议时呈报执行结果。改善行动列表不宜过长，应该聚焦于少量最重要的改进项。
　　可视化故事墙：
　　　　将用户需求写到卡片上，并根据当前的状态或者所处的阶段，放置于相应的位置
　　　　需包含需求产生到功能上线的全过程
　　明确“完成”的定义：
　　　　多人协作过程最容易出现的就是理解不一致
　　　　团队应该尽可能对每类任务都定义“完成”的标准
　　持续集成：
　　　　将需求分解成更细粒度后，团队多人可以并行开展工作，同时也应该将工作成果持续集成在一起，并确保达到质量标准
　　故事验证：达成共识 -> 开发 -> 自测 -> 迷你验收 -> 故事验证
